---
title: "Having fun playing with Twitter data"
author: "Kelly Sovacool"
date: "`r format(Sys.Date(), '%Y-%m-%d')`"
output:
  html_document:
    theme: "yeti"
    toc: true
    toc_float: true
github-repo: kelly-sovacool/twitter-stats
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding, output_dir = "docs") })
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = 'figures/'
)
```


```{r deps, message = FALSE}
library(here)
library(tidyverse)
library(rtweet)
```

```{r authenticate, eval = FALSE}
auth_setup_default()
```

```{r get_my_tweets}
my_username <- 'kelly_sovacool'
me <- lookup_users(my_username)
num_tweets <- me[['statuses_count']]
#my_tweets_all <- get_timeline(user = me[['id']], n = num_tweets, retryonratelimit = TRUE) # Error: $ operator is invalid for atomic vectors 
my_tweets <- get_timeline(user = me[['id']], 
                          n = 1100, 
                          retryonratelimit = TRUE)
my_tweets_orig <- my_tweets %>% 
  filter(!startsWith(text, 'RT @')) # no retweets
my_tweets_orig_noreplies <- my_tweets_orig %>% 
    filter(is.na(in_reply_to_status_id)) # no replies
```

## most liked tweets

```{r most_liked, results = 'asis'}
most_liked <- my_tweets_orig %>% 
    slice_max(favorite_count, n = 5)
embeds <- 
    sapply(most_liked %>% pull('id_str'), 
           function(x) { cat(tweet_embed(screen_name = my_username, 
                                     status_id = x))
               })
```


## most retweeted tweets

```{r most_rtd, results = 'asis'}
most_rtd <- my_tweets_orig %>% 
    slice_max(retweet_count, n = 5)
embeds <- 
    sapply(most_rtd %>% pull('id_str'), 
           function(x) { cat(tweet_embed(screen_name = my_username, 
                                     status_id = x))
               })
```

## plots!

```{r plot_hist}
my_tweets_orig_noreplies %>% 
    pivot_longer(c(favorite_count, retweet_count),
                 names_to = 'engagement_type',
                 values_to = 'engagement_count') %>% 
    ggplot(aes(engagement_count, fill = engagement_type)) +
    geom_histogram(alpha = 0.7) +
    facet_wrap('engagement_type', nrow = 1, scales = 'free') +
    labs(x = '') +
    theme_bw() +
    theme(legend.position = 'none')
```

```{r plot_likes-vs-RTs}
my_tweets_orig_noreplies %>% 
  ggplot(aes(retweet_count, favorite_count)) +
  geom_point(alpha = 0.7, size = 2) +
  geom_smooth(show.legend = FALSE) +
  theme_bw()
```

```{r plot_time}
my_tweets_orig_noreplies %>% 
  mutate(created_datetime = lubridate::as_datetime(created_at, format = '%a %b %d %H:%M:%S +0000 %Y')) %>% 
  pivot_longer(c(favorite_count, retweet_count),
               names_to = 'engagement_type',
               values_to = 'engagement_count') %>% 
  ggplot(aes(created_datetime, engagement_count, color = engagement_type)) +
  geom_smooth(show.legend = FALSE) +
  geom_point(alpha = 0.5, size = 2) +
  scale_x_datetime(date_breaks = "3 months", date_labels = "%b %Y") + 
  labs(y='', x='') +
  theme_bw() +
  theme(legend.title = element_blank(),
        legend.position = 'bottom',
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```
